name: Procesar Aplicación Laboral

on:
  push:
    paths:
      - 'to_process/*.yaml'

jobs:
  procesar-cv:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install pyyaml pandas

      - name: Ejecutar procesamiento de aplicación
        run: |
          for file in to_process/*.yaml; do
            python aplicaciones_laborales/scripts/procesar_aplicacion.py "$file"
          done

      - name: Copiar archivos generados a /aplicaciones/por fecha
        run: |
          FECHA=$(date +%Y-%m-%d)
          mkdir -p "aplicaciones/$FECHA"
          if [ -d to_process_procesados ]; then
            cp -r to_process_procesados/* "aplicaciones/$FECHA/" || true
          fi

      - name: Hacer commit de archivos generados
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add aplicaciones/
          git commit -m "Add processed applications to /aplicaciones/ por fecha" || echo "No changes to commit"
          git push
